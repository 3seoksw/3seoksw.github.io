<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Double DQN implementaion on Super Mario Bros. | WooSeok Kim</title> <meta name="author" content="WooSeok Kim"> <meta name="description" content="DDQN implementaion using Mario (gym) API"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%92%BB&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://3seoksw.github.io/projects/DDQN-Mario/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">WooSeok </span>Kim</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/paper-reviews/">Paper Reviews</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Double DQN implementaion on Super Mario Bros.</h1> <p class="post-description">DDQN implementaion using Mario (gym) API</p> </header> <article> <h1 id="double-dqn-super-mario-bros">Double DQN: Super Mario Bros.</h1> <p><a href="https://github.com/3seoksw/DDQN-mario" rel="external nofollow noopener" target="_blank">This project</a> is built based on the paper regarding <b>Double DQN</b><a href="#1">[1]</a>.<br></p> <h2 id="to-get-started">To Get Started</h2> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@github.com:3seoksw/DDQN-mario.git
</code></pre></div></div> <p>In order to properly run the code, first clone the repository.<br> And create new virtual environment using the <code class="language-plaintext highlighter-rouge">requirements.txt</code>. Here, I’m using <code class="language-plaintext highlighter-rouge">conda</code>.<br></p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda create <span class="nt">--name</span> &lt;your-env&gt; <span class="nt">--file</span> requirements.txt
conda activate &lt;your-env&gt;
</code></pre></div></div> <p>After setting up the virtual environment and the code, run <code class="language-plaintext highlighter-rouge">main.py</code>.<br></p> <p><strong>Note</strong>: <a href="https://pypi.org/project/nes-py/" rel="external nofollow noopener" target="_blank">nes-py 8.2.1</a> (from <a href="https://pypi.org/project/gym-super-mario-bros/" rel="external nofollow noopener" target="_blank">gym-super-mario-bros 7.4.0</a>) and <a href="https://gymnasium.farama.org/content/migration-guide/" rel="external nofollow noopener" target="_blank">gym 0.26.0</a> are not compatible. There is a difference in <code class="language-plaintext highlighter-rouge">reset()</code> function’s signature between two APIs.<br> There are few workarounds but I erased every <code class="language-plaintext highlighter-rouge">truncated</code> keyword in <code class="language-plaintext highlighter-rouge">time_limit.py</code> from imported package directory.</p> <h2 id="problem-justification">Problem Justification</h2> \[\begin{align*} \text{State}: &amp;\text{current image frame} (\text{channel} \times \text{height} \times \text{width}) \\ \text{Action}: &amp;\text{set of actions agent Mario can take} \\ &amp;\textit{e.g.}) \text{move forward, jump, } \textit{etc.} \\ \text{Reward}: &amp;\text{distance agent moved} \\ &amp;\text{coins agent acquired} \\ &amp;\text{enemies agent killed} \\ &amp;\text{time consumed} \\ &amp;\text{reached to the final flag (terminal state)} \\ &amp;\textit{etc.} \\ \end{align*}\] <p>Since states are in the forms of image frames, CNN will be used which consists of three convolutional layers paired with ReLU function, flattening layer, densifying the tensor processed, and two fully-connected neural networks. <br></p> <h2 id="background">Background</h2> <p>There are some similarities between DQN and Double DQN (DDQN) in terms of both taking advantage of using $Q$ values. But there is a major difference for the method to update \(Q\) value. For further reference, please see <a href="#1">[1]</a>.</p> <h3 id="dqn">DQN</h3> <p>In \(Q\)-learning, objective is to find optimal \(Q\) value which is parameterized by \(\theta\). The \(Q\)-learning update requires some action \(A_t\), state \(S_t\), and reward \(R_{t+1}\), then we can get:</p> \[\begin{aligned} \theta_{t+1} &amp;= \theta_t + \alpha(Y^{Q}_t - Q(S_t, A_t; \theta_t)) \nabla_{\theta_t}Q(S_t, A_t; \theta_t) \end{aligned}\] <p>where \(\alpha\) is a step size. And the target \(Y_t^Q\) is defined as:</p> \[\begin{aligned} Y_t^Q \equiv R_{t+1} + \gamma \text{max}_aQ(S_{t+1}, a; \theta_t) \\ Y^Q_t \approx Q(S_t, A_t; \theta_t) \end{aligned}\] <p>However, the target value can cause overestimation. Therefore, DDQN is proposed.</p> <h3 id="double-dqn">Double DQN</h3> <p>While applying the same fundamental foundations from DQN, experience replay and target network, DDQN uses two separate \(Q\)-networks; online network which is for selecting the best action and target network which is for evaluating the action. You can simply think DDQN is separating DQN’s target network into two.</p> <p>The target is as follows:</p> \[\begin{aligned} Y_t^{\text{DQN}} \equiv R_{t+1} + \gamma \text{max}_a Q(S_{t+1}, a; \theta_t^{-}) \end{aligned}\] <p>where \(\theta^{-}\) is a vector parameters of target network. And the Double \(Q\)-learning error can be written as follows:</p> \[\begin{aligned} Y_t^{\text{DoubleQ}} \equiv R_{t+1} + \gamma Q_{\text{eval}}^{\text{target}}(S_{t+1}, \text{argmax}_a Q_{\text{select}}^{\text{online}}(S_{t+1}, a; \theta_t); \theta_t^{-} ) \end{aligned}\] <p>where \(\theta\) is parameterizing online network.</p> <h2 id="references">References</h2> <p><a id="1" href="https://ojs.aaai.org/index.php/AAAI/article/view/10295" rel="external nofollow noopener" target="_blank">[1]</a> H. v. Hasselt, A. Guez, and D. Silver. “Deep Reinforcement Learning with Double Q-learning,” <i>Proceedings of the AAAI Conference on Artificial Intelligence, 30(1)</i>, 2016.</p> </article> <h2>References</h2> <div class="publications"> <h2 class="bibliography">2015</h2> <ol class="bibliography"><li> <div class="row"> <div class="col-sm-2 preview"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/publication_preview/ddqn-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/publication_preview/ddqn-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/publication_preview/ddqn-1400.webp"></source> <img src="/assets/img/publication_preview/ddqn.png" class="preview z-depth-1 rounded" width="auto" height="auto" alt="ddqn.png" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div id="vanhasselt2015deep" class="col-sm-8"> <div class="title">Deep Reinforcement Learning with Double Q-learning</div> <div class="author"> Hado Hasselt, Arthur Guez, and David Silver</div> <div class="periodical"> 2015 </div> <div class="periodical"> </div> <div class="links"> <a class="bibtex btn btn-sm z-depth-0" role="button">Bib</a> </div> <div class="bibtex hidden"> <figure class="highlight"><pre><code class="language-bibtex" data-lang="bibtex"><span class="nc">@misc</span><span class="p">{</span><span class="nl">vanhasselt2015deep</span><span class="p">,</span>
  <span class="na">title</span> <span class="p">=</span> <span class="s">{Deep Reinforcement Learning with Double Q-learning}</span><span class="p">,</span>
  <span class="na">author</span> <span class="p">=</span> <span class="s">{van Hasselt, Hado and Guez, Arthur and Silver, David}</span><span class="p">,</span>
  <span class="na">year</span> <span class="p">=</span> <span class="s">{2015}</span><span class="p">,</span>
  <span class="na">eprint</span> <span class="p">=</span> <span class="s">{1509.06461}</span><span class="p">,</span>
  <span class="na">archiveprefix</span> <span class="p">=</span> <span class="s">{arXiv}</span><span class="p">,</span>
  <span class="na">primaryclass</span> <span class="p">=</span> <span class="s">{cs.LG}</span><span class="p">,</span>
<span class="p">}</span></code></pre></figure> </div> </div> </div> </li></ol> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 WooSeok Kim. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>